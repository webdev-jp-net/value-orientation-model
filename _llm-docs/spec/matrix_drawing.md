# マトリクス描画仕様

CURRENT GRAVITYのマトリクス（分布図）を描画するための技術仕様および実装詳細。

## 設計思想

このマトリクスは、優劣を意識させない「志向の分布図」であり、一般的な「グラフ」としての佇まいを排除することを最優先とする。

- **グラフ感の排除**: ライブラリのデフォルト機能であっても、外枠（囲い線）、目盛り（Ticks）、数値ラベルを表示させることは厳禁とする。データの正確な読み取りよりも、志向の広がりを直感的に捉える佇まいを優先する。
- **方向性の明示**: 中心から上下左右の端点に向かう十字矢印は、このモデルの方向性を示す不可欠な意匠であり、実装方式によらず必ず継承する。

## 実装リソース

- **主要コンポーネント**: `components/ValueOrientationMatrix.tsx`
- **技術スタック**:
  - **ライブラリ**: VisX（Airbnb製Reactビジュアライゼーションライブラリ）
    - 使用パッケージ: `@visx/group`, `@visx/shape`, `@visx/scale`, `@visx/responsive`
  - **描画方式**: SVG（Scalable Vector Graphics）
- **データソース**: `PersonalPlot` データ（詳細は [model_definition.md](./model_definition.md) を参照）

## 描画ロジック

### 座標系
- **中心点**: マトリクスの幾何学的な中心を原点（0, 0）とする。
- **スケール**: `model_definition.md` に定義された2軸の合計値（-20 〜 20）をマトリクスの表示領域に線形マッピングする。
- **反転**: Y軸（帰属志向）は、数学的な正負とSVGの座標系（上が0）を合わせるため、描画時に反転処理を行う。

### 意匠（デザイン要素）
- **十字矢印**: 中心から上下左右の端点に向かう軸線。先端には2本の線で構成された鋭角な矢印（「く」の字型）を配置し、方向性を明示する。
- **背景**: 純粋な白背景（LINE Design System準拠）とし、クリーンな佇まいを維持する。

## 視認性向上（衝突回避）

プロットが密集した際のラベルの可読性を確保するため、以下の機能を導入している。

### 全方位探索配置
ラベルの物理的な矩形（推定幅と高さ）を考慮し、プロット本体や他のラベルと衝突しない位置を以下の優先順位で探索する。データの更新（プロットの追加・削除など）に合わせてリアルタイムに再計算される。
1. 上下左右（4方向）
2. 斜め（4方向）
探索結果に基づき、もっとも衝突が少ない位置に自動配置し、`text-anchor`を適切に切り替える。

### 動的フォーカス
特定のプロットまたはラベルにオンマウス（またはタッチ）した際、以下の視覚効果を適用する。
- **カレント要素**: 不透明度1.0を維持。
- **非カレント要素**: 不透明度0.2に減光。
これにより、重なりが発生している箇所でも特定のデータを際立たせて読み取ることが可能となる。

## メンテナンス上の注意

- **依存関係**: 描画ロジックは`@visx/scale`および`@visx/shape`に依存している。座標計算を変更する場合は、これらのスケール定義を更新すること。
- **ラベル幅**: 現在の幅推定は文字数に基づく簡易的なものである。フォント変更などにより乖離が大きくなる場合は、推定係数の調整を検討すること。
